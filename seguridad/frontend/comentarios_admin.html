<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrador | Seguridad Industrial</title>
    <link rel="stylesheet" href="estilos.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f7f9fb;
            color: #333;
            margin: 0;
        }

        .app-window {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* üîπ Barra superior */
        .title-bar {
            background: #0d6efd;
            color: white;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            position: relative;
        }

        .window-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-btn {
            cursor: pointer;
            font-weight: bold;
            padding: 0 5px;
        }

        /* üîπ Bot√≥n rojo de cerrar sesi√≥n (arriba derecha) */
        .logout-btn-top {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
        }

        .logout-btn-top:hover {
            background: #b02a37;
        }

        .app-container {
            display: flex;
            flex: 1;
        }

        /* Sidebar */
        .sidebar {
            width: 230px;
            background: #ffffff;
            color: #333;
            display: flex;
            flex-direction: column;
            padding: 15px;
            border-right: 1px solid #ddd;
        }

        .sidebar h2 {
            text-align: center;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
            color: #0d6efd;
        }

        .sidebar nav a {
            display: block;
            color: #333;
            text-decoration: none;
            padding: 10px;
            margin: 4px 0;
            border-radius: 5px;
            transition: 0.2s;
        }

        .sidebar nav a.active {
            background: #0d6efd;
            color: white;
            font-weight: bold;
        }

        .sidebar nav a:hover {
            background: #0b5ed7;
            color: white;
        }

        /* Main */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .kpi-grid {
            display: flex;
            gap: 20px;
        }

        .kpi-card {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }

        .kpi-card.danger { border-top: 4px solid #dc3545; }
        .kpi-card.warning { border-top: 4px solid #ffc107; }
        .kpi-card.success { border-top: 4px solid #198754; }

        .tabla-incidencias table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 6px;
            overflow: hidden;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background: #e9ecef;
        }

        .export-buttons button {
            margin: 5px;
            padding: 10px 15px;
            background-color: #198754;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .export-buttons button:hover {
            background-color: #157347;
        }

        canvas {
            background: white;
            border-radius: 6px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .chart-section {
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="app-window">
        <!-- üîπ Barra superior con bot√≥n de cerrar sesi√≥n -->
        <div class="title-bar">
            <span>Sistema de Gesti√≥n de Seguridad Industrial (ADMINISTRADOR)</span> 
            <div class="window-controls">
                <a href="login.html" class="logout-btn-top" title="Cerrar Sesi√≥n">‚û°Ô∏è Cerrar Sesi√≥n</a>
                <span class="control-btn" title="Minimizar">_</span>
                <span class="control-btn" title="Maximizar">‚òê</span>
                <span class="control-btn" title="Cerrar">X</span>
            </div>
        </div>

        <div class="app-container">
            <!-- üìå Sidebar -->
            <aside class="sidebar">
                <h2>M√≥dulos</h2>
                <nav>
                    <a href="admin_dashboard.html" class="menu-link">üìä Dashboard / Inicio</a>
                    <a href="incidentes.html" class="menu-link">üìù Incidentes</a>
                    <a href="comentarios_admin.html" class="menu-link">üí¨ Gesti√≥n de Comentarios</a>
                    <a href="capacitaciones.html" class="menu-link">üìò Capacitaciones</a>
                </nav>
            </aside>
            
            <!-- üìå Contenido Principal -->
            <main class="main-content">
                <h2>Dashboard / Inicio</h2>

                <section class="notificaciones">
                    <h3>Notificaciones Importantes</h3>
                    <div class="notificacion alerta">
                        ‚ö†Ô∏è Se ha reportado un accidente en el √°rea de Taller de Maquinaria.
                    </div>
                    <div class="notificacion info">
                        ‚ÑπÔ∏è Pr√≥xima capacitaci√≥n: Uso seguro de equipos el√©ctricos ‚Äì 1 Oct, 10:00 AM.
                    </div>
                </section>

                <!-- üìä KPIs -->
                <section class="kpi-grid">
                    <div class="kpi-card danger">
                        <h3>Tasa de Frecuencia (LTIFR)</h3>
                        <p id="ltifr">0.3</p>
                    </div>
                    <div class="kpi-card warning">
                        <h3>Incidentes Reportados</h3>
                        <p id="incidentes-count">3</p>
                    </div>
                    <div class="kpi-card success">
                        <h3>Cumplimiento de Inspecciones</h3>
                        <p id="inspecciones">98%</p>
                    </div>
                </section>

                <!-- üìù Tablas -->
                <section class="tabla-incidencias">
                    <h3>Incidencias Recientes</h3>
                    <table id="tabla-incidentes">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Ubicaci√≥n</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>16/10/2025</td><td>Casi Accidente</td><td>Taller Maquinaria Pesada</td><td>Pendiente</td></tr>
                            <tr><td>28/09/2025</td><td>Accidente con Lesi√≥n</td><td>Taller Mec√°nico</td><td>En Investigaci√≥n</td></tr>
                            <tr><td>20/09/2025</td><td>Casi Accidente</td><td>Zona de Carga</td><td>Resuelto</td></tr>
                        </tbody>
                    </table>
                </section>

                <section class="tabla-incidencias">
                    <h3>Comentarios Recientes</h3>
                    <table id="tabla-comentarios">
                        <thead>
                            <tr><th>Fecha</th><th>Empleado</th><th>Comentario</th><th>Estado</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>15/10/2025</td><td>Juan P√©rez</td><td>Falta iluminaci√≥n en taller</td><td>Pendiente</td></tr>
                            <tr><td>12/10/2025</td><td>Mar√≠a L√≥pez</td><td>Se necesita EPP en zona qu√≠mica</td><td>Resuelto</td></tr>
                        </tbody>
                    </table>
                </section>

                <section class="tabla-incidencias">
                    <h3>Capacitaciones Programadas</h3>
                    <table id="tabla-capacitaciones">
                        <thead>
                            <tr><th>Fecha</th><th>Tema</th><th>Instructor</th><th>Estado</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>25/10/2025</td><td>Seguridad El√©ctrica</td><td>Ing. Torres</td><td>Pendiente</td></tr>
                            <tr><td>30/10/2025</td><td>Uso de Extintores</td><td>Lic. G√≥mez</td><td>Programada</td></tr>
                        </tbody>
                    </table>
                </section>

                <!-- üìà Gr√°ficos -->
                <section class="chart-section">
                    <h3>üìä Gr√°ficos de Seguridad</h3>
                    <canvas id="chartTipos" width="400" height="200"></canvas>
                    <canvas id="chartEstados" width="400" height="200"></canvas>
                </section>

                <!-- üì§ Exportar Reportes -->
                <section class="exportar-section">
                    <h3>üì§ Exportar Reportes</h3>
                    <div class="export-buttons">
                        <button onclick="exportarExcel('incidentes')">üìä Incidentes a Excel</button>
                        <button onclick="exportarExcel('comentarios')">üí¨ Comentarios a Excel</button>
                        <button onclick="exportarExcel('capacitaciones')">üìò Capacitaciones a Excel</button>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- ‚úÖ Librer√≠as -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <script>
        // üìä Gr√°ficos din√°micos
        document.addEventListener("DOMContentLoaded", function () {
            const tipos = ["Casi Accidente", "Accidente con Lesi√≥n"];
            const cantidad = [2, 1];

            const estados = ["Pendiente", "En Investigaci√≥n", "Resuelto"];
            const cantidadEstados = [1, 1, 1];

            new Chart(document.getElementById('chartTipos'), {
                type: 'bar',
                data: {
                    labels: tipos,
                    datasets: [{
                        label: 'Cantidad de Incidentes',
                        data: cantidad,
                        backgroundColor: ['#0d6efd', '#ffc107']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } }
                }
            });

            new Chart(document.getElementById('chartEstados'), {
                type: 'pie',
                data: {
                    labels: estados,
                    datasets: [{
                        data: cantidadEstados,
                        backgroundColor: ['#dc3545', '#0d6efd', '#198754']
                    }]
                }
            });
        });

        // üì§ Exportar tablas a Excel
        function exportarExcel(tipo) {
            let tablaId = '';
            if (tipo === 'incidentes') tablaId = 'tabla-incidentes';
            else if (tipo === 'comentarios') tablaId = 'tabla-comentarios';
            else if (tipo === 'capacitaciones') tablaId = 'tabla-capacitaciones';

            const tabla = document.getElementById(tablaId);
            if (!tabla) {
                alert('No se encontr√≥ la tabla: ' + tipo);
                return;
            }

            const wb = XLSX.utils.table_to_book(tabla, { sheet: tipo });
            XLSX.writeFile(wb, tipo + '_' + new Date().toISOString().split('T')[0] + '.xlsx');
        }

        // üîπ Resaltar enlace activo
        document.addEventListener("DOMContentLoaded", () => {
            const currentPage = window.location.pathname.split("/").pop();
            const links = document.querySelectorAll(".menu-link");
            links.forEach(link => {
                if (link.getAttribute("href") === currentPage) {
                    link.classList.add("active");
                } else {
                    link.classList.remove("active");
                }
            });
        });
    </script>
</body>
</html>
